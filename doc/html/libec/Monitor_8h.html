<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libec: /home/fontoura/workspace/github/ectools/include/libec/monitor/Monitor.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libec
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_12b874397796f7497981b4feaad9e70b.html">include</a></li><li class="navelem"><a class="el" href="dir_ec3bde3d5c905149b4744bc45391af9d.html">libec</a></li><li class="navelem"><a class="el" href="dir_8f7e52bf0fa20587d910b134778e8888.html">monitor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">Monitor.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class to extend to build the specific monitor.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;iostream&gt;</code><br/>
<code>#include &lt;vector&gt;</code><br/>
<code>#include &lt;map&gt;</code><br/>
<code>#include &quot;<a class="el" href="Tools_8h_source.html">../tools/Tools.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="Value_8h_source.html">../value/Value.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="GridModel_8h_source.html">../grid/model/GridModel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="GridFilter_8h_source.html">../grid/filter/GridFilter.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="GridView_8h_source.html">../grid/view/GridView.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="GridCtrl_8h_source.html">../grid/controller/GridCtrl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="MonitorLoader_8h_source.html">config/MonitorLoader.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="Loadable_8h_source.html">config/Loadable.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="Globals_8h_source.html">../Globals.h</a>&quot;</code><br/>
</div>
<p><a href="Monitor_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcea_1_1Monitor.html">cea::Monitor</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class to extend to build the specific monitor.  <a href="classcea_1_1Monitor.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcea_1_1Monitor_1_1cast.html">cea::Monitor::cast&lt; T &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cast operator.  <a href="structcea_1_1Monitor_1_1cast.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcea_1_1Monitor_1_1ColumnIterator.html">cea::Monitor::ColumnIterator&lt; TAG, CAST &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Column "tag" Iterator.  <a href="classcea_1_1Monitor_1_1ColumnIterator.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcea_1_1Monitor_1_1RowIterator.html">cea::Monitor::RowIterator&lt; TAG, CAST &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Row "tag" Iterator.  <a href="classcea_1_1Monitor_1_1RowIterator.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class to extend to build the specific monitor. </p>
<dl class="section author"><dt>Author</dt><dd>Dorian RODDE </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2012.07 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2012, CoolEmAll (INFSO-ICT-288701) </dd></dl>
<h1><a class="anchor" id="example1"></a>
Short example of monitor loaded from XML file</h1>
<p>This example show how to create a monitor of running process from a XML file.</p>
<p>This example create a terminal view and a html view in data.html controlled by a TerminalController.</p>
<p>This code works on Linux and Windows without changing anything.</p>
<h3>XML monitor loaded</h3>
<div class="fragment"><div class="line">&lt;monitor&gt;</div>
<div class="line">  &lt;!-- Column Tag --&gt;</div>
<div class="line">  &lt;!-- 0 == Name --&gt;</div>
<div class="line">  &lt;!-- 1 == PID --&gt;</div>
<div class="line">  &lt;!-- 2 == Sensor --&gt;</div>
<div class="line"></div>
<div class="line">  &lt;freq value=<span class="stringliteral">&quot;200&quot;</span> /&gt;</div>
<div class="line"></div>
<div class="line">  &lt;column name=<span class="stringliteral">&quot;Name&quot;</span> type=<span class="stringliteral">&quot;string&quot;</span> size=<span class="stringliteral">&quot;30&quot;</span> tag=<span class="stringliteral">&quot;0&quot;</span> /&gt;</div>
<div class="line">  &lt;column name=<span class="stringliteral">&quot;PID&quot;</span> type=<span class="stringliteral">&quot;int&quot;</span> size=<span class="stringliteral">&quot;10&quot;</span> tag=<span class="stringliteral">&quot;1&quot;</span> /&gt;</div>
<div class="line"></div>
<div class="line">  &lt;column name=<span class="stringliteral">&quot;S1&quot;</span> type=<span class="stringliteral">&quot;int&quot;</span> size=<span class="stringliteral">&quot;10&quot;</span> tag=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;sensor&quot;</span></div>
<div class="line">                                            <span class="keywordtype">object</span>=<span class="stringliteral">&quot;fakesensor&quot;</span>  /&gt;</div>
<div class="line">  &lt;column name=<span class="stringliteral">&quot;S2&quot;</span> type=<span class="stringliteral">&quot;int&quot;</span> size=<span class="stringliteral">&quot;10&quot;</span> tag=<span class="stringliteral">&quot;2&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;sensor&quot;</span></div>
<div class="line">                                            <span class="keywordtype">object</span>=<span class="stringliteral">&quot;fakesensor&quot;</span>&gt;</div>
<div class="line">    &lt;arg <span class="keywordtype">id</span>=<span class="stringliteral">&quot;54&quot;</span> type=<span class="stringliteral">&quot;float&quot;</span> value=<span class="stringliteral">&quot;78.56&quot;</span> /&gt;</div>
<div class="line">    &lt;arg type=<span class="stringliteral">&quot;string&quot;</span> value=<span class="stringliteral">&quot;FakeSensor test&quot;</span> /&gt;</div>
<div class="line">  &lt;/column&gt;</div>
<div class="line">&lt;/monitor&gt;</div>
<div class="line"></div>
<div class="line">&lt;view type=<span class="stringliteral">&quot;term&quot;</span> ctrl=<span class="stringliteral">&quot;term&quot;</span>&gt;</div>
<div class="line">  &lt;show columns=<span class="stringliteral">&quot;Name,PID,S1&quot;</span> /&gt;</div>
<div class="line"></div>
<div class="line">  &lt;filter value=<span class="stringliteral">&quot;PID &lt; 2000&quot;</span> /&gt;</div>
<div class="line"></div>
<div class="line">  &lt;style <span class="keywordtype">id</span>=<span class="stringliteral">&quot;1&quot;</span> align=<span class="stringliteral">&quot;Center&quot;</span> color=<span class="stringliteral">&quot;#ff0000&quot;</span> /&gt;</div>
<div class="line">  &lt;style <span class="keywordtype">id</span>=<span class="stringliteral">&quot;2&quot;</span> align=<span class="stringliteral">&quot;RIGHT&quot;</span> suffix=<span class="stringliteral">&quot;%&quot;</span> color=<span class="stringliteral">&quot;#00FF00&quot;</span> /&gt;</div>
<div class="line"></div>
<div class="line">  &lt;style <span class="keywordtype">id</span>=<span class="stringliteral">&quot;100&quot;</span> backcolor=<span class="stringliteral">&quot;#FFFF00&quot;</span> color=<span class="stringliteral">&quot;#ff0000&quot;</span>/&gt;</div>
<div class="line">  &lt;style <span class="keywordtype">id</span>=<span class="stringliteral">&quot;50&quot;</span> backcolor=<span class="stringliteral">&quot;#008000&quot;</span> color=<span class="stringliteral">&quot;#ff0000&quot;</span>/&gt;</div>
<div class="line"></div>
<div class="line">  &lt;style-filter filter=<span class="stringliteral">&quot;(S1 &gt; 10000)&quot;</span> style=<span class="stringliteral">&quot;100&quot;</span> /&gt;</div>
<div class="line">  &lt;sort by=<span class="stringliteral">&quot;Name&quot;</span> order=<span class="stringliteral">&quot;asc&quot;</span> /&gt;</div>
<div class="line"></div>
<div class="line">  &lt;sum columns=<span class="stringliteral">&quot;S1&quot;</span> /&gt;</div>
<div class="line"></div>
<div class="line">  &lt;position x=<span class="stringliteral">&quot;0&quot;</span> y=<span class="stringliteral">&quot;3&quot;</span> offseth=<span class="stringliteral">&quot;3&quot;</span> offsetw=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line"></div>
<div class="line">  &lt;log type=<span class="stringliteral">&quot;file&quot;</span></div>
<div class="line">       format=<span class="stringliteral">&quot;xml&quot;</span></div>
<div class="line">       flush-freq=<span class="stringliteral">&quot;4000&quot;</span></div>
<div class="line">       flush-max-item=<span class="stringliteral">&quot;100&quot;</span></div>
<div class="line">       filter=<span class="stringliteral">&quot;(PID &gt; 1000) . (PID &lt; 2000)&quot;</span> /&gt;</div>
<div class="line"></div>
<div class="line">  &lt;log-type clear=<span class="stringliteral">&quot;false&quot;</span> file=<span class="stringliteral">&quot;out.log&quot;</span> /&gt;</div>
<div class="line">  &lt;log-format attr-mode=<span class="stringliteral">&quot;true&quot;</span> /&gt;</div>
<div class="line">&lt;/view&gt;</div>
<div class="line"></div>
<div class="line">&lt;view type=<span class="stringliteral">&quot;html&quot;</span> ctrl=<span class="stringliteral">&quot;term&quot;</span>&gt;</div>
<div class="line">    &lt;output file=<span class="stringliteral">&quot;data.html&quot;</span> /&gt;</div>
<div class="line">&lt;/view&gt;</div>
</div><!-- fragment --><h3>Monitor source</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="monitors_8h.html" title="All headers file needed for monitor.">libec/monitors.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="process_8h.html" title="All headers file needed for process enumeration.">libec/process.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sensors_8h.html" title="A header with all the sensors that can be instantiated.">libec/sensors.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This using namespace is only to keep the example as short as possible</span></div>
<div class="line"><span class="comment">// but in C++ is better to avoid it.</span></div>
<div class="line"><span class="keyword">using namespace </span>cea;</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>MyMonitor : <span class="keyword">public</span> <a class="code" href="classcea_1_1Monitor.html" title="Class to extend to build the specific monitor.">Monitor</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Column tags</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NAME = 0;</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> PID = 1;</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> SENSOR_U64 = 2;</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> SENSOR_FLOAT = 3;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Member</span></div>
<div class="line">  <span class="keywordtype">bool</span> isFreezed;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Constructor</span></div>
<div class="line">  MyMonitor()</div>
<div class="line">    : isFreezed(false)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Add loader</span></div>
<div class="line">    loadMapMonitorable&lt;FakeSensor&gt;(<span class="stringliteral">&quot;sensor&quot;</span>, <span class="stringliteral">&quot;FakeSensor&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Event raised by Monitor after a Row created</span></div>
<div class="line">  <span class="keywordtype">void</span> onRowCreate(Row&amp; r)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (r.tag == FEEDER_PROCESS_ITEM) {</div>
<div class="line">      setValue(r, NAME, cast&lt;Process&gt;(r)-&gt;getName());</div>
<div class="line">      setValue(r, PID, cast&lt;Process&gt;(r)-&gt;getPid());</div>
<div class="line">     }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Event raised when a row need updated</span></div>
<div class="line">  <span class="keywordtype">void</span> onRowUpdate(Row&amp; r)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (r.tag == FEEDER_PROCESS_ITEM) {</div>
<div class="line">      <a class="code" href="classcea_1_1Process.html" title="Base class for Process implementation.">Process</a>&amp; p = cast&lt;Process&gt;(r);</div>
<div class="line">      <span class="comment">// Update Sensor U64</span></div>
<div class="line">      <span class="keywordflow">for</span>(ColumnIterator&lt;SENSOR_U64, Sensor&gt; s = <span class="keyword">this</span>; s != 0; ++s) {</div>
<div class="line">        setValue(r, s, s-&gt;getValue(p.<a class="code" href="classcea_1_1Process.html#a4d0f82ae44ed4aff5f34a604f607b6b6" title="Get process Identificator.">getPid</a>()).U64);</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// Update Sensor Float</span></div>
<div class="line">      <span class="keywordflow">for</span>(ColumnIterator&lt;SENSOR_FLOAT, Sensor&gt; s = <span class="keyword">this</span>; s != 0; ++s){</div>
<div class="line">        setValue(r, s, s-&gt;getValue(p.<a class="code" href="classcea_1_1Process.html#a4d0f82ae44ed4aff5f34a604f607b6b6" title="Get process Identificator.">getPid</a>()).Float);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Model</span></div>
<div class="line">  MyMonitor m;</div>
<div class="line">  ProcessEnumerator pe;</div>
<div class="line">  <span class="comment">// Connect Process enumerator to monitor</span></div>
<div class="line">  m.connectRowFeeder(&amp;pe);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Load monitor</span></div>
<div class="line">  m.loadFile(<span class="stringliteral">&quot;monitor.xml&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Variable to know application running status</span></div>
<div class="line">  <span class="keywordtype">bool</span> isRunning = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Main Loop</span></div>
<div class="line">  <span class="keywordflow">while</span> (isRunning) {</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Update Monitor</span></div>
<div class="line">    <span class="keywordflow">if</span> (!m.isFreezed) {</div>
<div class="line">      m.update();</div>
<div class="line">      pe.update();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Handle Terminal Event</span></div>
<div class="line">    <span class="keywordtype">int</span> c = <a class="code" href="classcea_1_1Console.html#a1e93434f12197a14f59107045f7deced" title="Get async terminal key hit.">Console::keyHit</a>();</div>
<div class="line">    <span class="keywordflow">switch</span> (c) {</div>
<div class="line">      <span class="keywordflow">case</span> 0:</div>
<div class="line">        <span class="comment">// = No key hit (keyHit is async method -&gt; return 0 if no key)</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;Q&#39;</span>:</div>
<div class="line">        <span class="comment">// Key for exit the application</span></div>
<div class="line">        isRunning = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>:</div>
<div class="line">        <span class="comment">// Key to pause the monitor</span></div>
<div class="line">        m.isFreezed = !m.isFreezed;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:</div>
<div class="line">        <span class="comment">// Refresh</span></div>
<div class="line">        m.loadFile(<span class="stringliteral">&quot;monitor.xml&quot;</span>);</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="comment">// Create a Terminal KeyHit GridCtrl event</span></div>
<div class="line">        <a class="code" href="structcea_1_1GridCtrl_1_1Event.html" title="Structure representing an event.">GridCtrl::Event</a> e(<a class="code" href="structcea_1_1GridCtrl_1_1Event.html#ad45a895809cd1043e99fa5853c4f66b3aa70ce3014e1ac357d5f03a2d94b4667c">GridCtrl::Event::TERM_KEYHIT</a>, c);</div>
<div class="line">        <span class="comment">// If other key -&gt; let the monitor controllers handle the event</span></div>
<div class="line">        m.handleEvent(e);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Render Views</span></div>
<div class="line">    m.renderViews();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Do a sleep of 50 ms to avoid comsuption of all CPU</span></div>
<div class="line">    <span class="comment">// with letting the interpretation of key event</span></div>
<div class="line">    <a class="code" href="classcea_1_1Tools.html#a83760270530fbfde07cb6db7aa81f22a" title="Sleep the current process for a period expressed in milliseconds.">Tools::sleep_ms</a>(50);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="example2"></a>
Short example of a simple monitor</h1>
<p>This example show how to create a monitor of running process and show it in a terminal view.</p>
<p>This code works on Linux and Windows without changing anything.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="monitors_8h.html" title="All headers file needed for monitor.">libec/monitors.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="process_8h.html" title="All headers file needed for process enumeration.">libec/process.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sensors_8h.html" title="A header with all the sensors that can be instantiated.">libec/sensors.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This using namespace is only to keep the example as short as possible</span></div>
<div class="line"><span class="comment">// but in C++ is better to avoid it.</span></div>
<div class="line"><span class="keyword">using namespace </span>cea;</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>MyMonitor : <span class="keyword">public</span> <a class="code" href="classcea_1_1Monitor.html" title="Class to extend to build the specific monitor.">Monitor</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Column tags</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NAME = 0;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> SENSOR_U64 = 2;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> SENSOR_FLOAT = 3;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Constructor</span></div>
<div class="line">    MyMonitor()</div>
<div class="line">    {</div>
<div class="line">        addColumn(<span class="stringliteral">&quot;Name&quot;</span>, <a class="code" href="classcea_1_1Value.html#a4da806c2f1d172256b4fcc320dc4b4a2ab0b7a1943b8c896b7ef0aaf3d3eb73b1" title="std::string">Value::STRING</a>, NAME,30,30);</div>
<div class="line">        addColumn(<span class="stringliteral">&quot;PID&quot;</span>, <a class="code" href="classcea_1_1Value.html#a4da806c2f1d172256b4fcc320dc4b4a2a417a74405d19d6d4862ec388fe0acbb7" title="long long int type">Value::INT</a>, PID);</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Add Sensor column</span></div>
<div class="line">    <span class="keywordtype">void</span> addSensor(<a class="code" href="classcea_1_1Sensor.html" title="Sensor abstract class.">Sensor</a>* s)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (s-&gt;<a class="code" href="classcea_1_1Sensor.html#a6de3e03e50bc6c8027168e995394f123">getType</a>() == U64) {</div>
<div class="line">            addMappedColumn(s, s-&gt;<a class="code" href="classcea_1_1Sensor.html#a6c2a54aa8b057a81618edd230b307e6f">getAlias</a>(), <a class="code" href="classcea_1_1Value.html#a4da806c2f1d172256b4fcc320dc4b4a2a417a74405d19d6d4862ec388fe0acbb7" title="long long int type">Value::INT</a>, SENSOR_U64);</div>
<div class="line">        }<span class="keywordflow">else</span>{</div>
<div class="line">            addMappedColumn(s, s-&gt;<a class="code" href="classcea_1_1Sensor.html#a6c2a54aa8b057a81618edd230b307e6f">getAlias</a>(), <a class="code" href="classcea_1_1Value.html#a4da806c2f1d172256b4fcc320dc4b4a2a0d92a6bde9440762557aebdff72e4956" title="double">Value::DOUBLE</a>, SENSOR_FLOAT);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Event raised by Monitor after a Row created</span></div>
<div class="line">    <span class="keywordtype">void</span> onRowCreate(Row&amp; r)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (r.tag == FEEDER_PROCESS_ITEM) {</div>
<div class="line">            setValue(r, NAME, cast&lt;Process&gt;(r)-&gt;getName());</div>
<div class="line">            setValue(r, PID, cast&lt;Process&gt;(r)-&gt;getPid());</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Event raised when a row need updated</span></div>
<div class="line">    <span class="keywordtype">void</span> onRowUpdate(Row&amp; r)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (r.tag == FEEDER_PROCESS_ITEM) {</div>
<div class="line">            <a class="code" href="classcea_1_1Process.html" title="Base class for Process implementation.">Process</a>&amp; p = cast&lt;Process&gt;(r);</div>
<div class="line">            <span class="comment">// Update Sensor U64</span></div>
<div class="line">            <span class="keywordflow">for</span>(ColumnIterator&lt;SENSOR_U64, Sensor&gt; s = <span class="keyword">this</span>; s != 0; ++s) {</div>
<div class="line">                setValue(r, s, s-&gt;<a class="code" href="classcea_1_1Sensor.html#ac016b603accc50ee5413f832366152d5" title="Gets sensor&#39;s current value (for the entire system).">getValue</a>(p.<a class="code" href="classcea_1_1Process.html#a4d0f82ae44ed4aff5f34a604f607b6b6" title="Get process Identificator.">getPid</a>()).U64);</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Update Sensor Float</span></div>
<div class="line">            <span class="keywordflow">for</span>(ColumnIterator&lt;SENSOR_FLOAT, Sensor&gt; s = <span class="keyword">this</span>; s != 0; ++s){</div>
<div class="line">                setValue(r, s, s-&gt;<a class="code" href="classcea_1_1Sensor.html#ac016b603accc50ee5413f832366152d5" title="Gets sensor&#39;s current value (for the entire system).">getValue</a>(p.<a class="code" href="classcea_1_1Process.html#a4d0f82ae44ed4aff5f34a604f607b6b6" title="Get process Identificator.">getPid</a>()).Float);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Model</span></div>
<div class="line">    MyMonitor m;</div>
<div class="line">    ProcessEnumerator pe;</div>
<div class="line">    <span class="comment">// Connect Process enumerator to monitor</span></div>
<div class="line">    m.connectRowFeeder(&amp;pe);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// View</span></div>
<div class="line">    <a class="code" href="classcea_1_1TermGridView.html" title="Terminal GridModel view.">TermGridView</a> view(m);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Controller</span></div>
<div class="line">    <a class="code" href="classcea_1_1TermGridCtrl.html" title="Terminal grid controller.">TermGridCtrl</a> termCtrl(view);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Start Text</span></div>
<div class="line">    <a class="code" href="classcea_1_1Console.html#a631acdc7fe7195dac6391fa0072afb00" title="Draw a text to the current position with the current console style.">Console::drawText</a>(<span class="stringliteral">&quot;My Monitor&quot;</span>, 0, 0);</div>
<div class="line">    <a class="code" href="classcea_1_1Console.html#a631acdc7fe7195dac6391fa0072afb00" title="Draw a text to the current position with the current console style.">Console::drawText</a>(<span class="stringliteral">&quot;\t(use &#39;1&#39;..&#39;9&#39; to sort, &#39;=&#39;+&#39;1&#39;..&#39;9&#39; to sum,&quot;</span> +</div>
<div class="line">                      <span class="stringliteral">&quot;&#39;f&#39;+&#39;1&#39;..&#39;9&#39; to fix)&quot;</span>, 0, 1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Place the view</span></div>
<div class="line">    view.move(0,3);</div>
<div class="line">    <span class="comment">// Set auto size with offset</span></div>
<div class="line">    view.setAutoSize(<a class="code" href="structcea_1_1GridView_1_1AutoSize.html" title="Autosize Settings.">GridView::AutoSize</a>(0,3));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create a style for Sensor</span></div>
<div class="line">    <a class="code" href="structcea_1_1GridStyle.html" title="Style for GridView column, row and cell.">GridStyle</a> s;</div>
<div class="line">    s.<a class="code" href="structcea_1_1GridStyle.html#a7defc60023712dbc3331641c34f1f55f" title="Set text suffix.">setSuffix</a>(<span class="stringliteral">&quot; u/s&quot;</span>).<a class="code" href="structcea_1_1GridStyle.html#a24115b897132e9ae9839477b60996f0f" title="Set text align.">setAlign</a>(<a class="code" href="structcea_1_1GridStyle.html#a58efb29986275a5437f0e82079728a6fa289360903824d961be7303c281e965d7" title="Right text align.">GridStyle::RIGHT</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Set style for sensor Column in the view</span></div>
<div class="line">    view.setStyle(MyMonitor::SENSOR_U64, s);</div>
<div class="line">    view.setStyle(MyMonitor::SENSOR_FLOAT, s);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Add a Fake Sensor</span></div>
<div class="line">    <a class="code" href="classcea_1_1FakeSensor.html" title="Fake sensor used for Monitor test.">FakeSensor</a> s1;</div>
<div class="line">    m.addSensor(&amp;s1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Variable to pause monitor and know application running status</span></div>
<div class="line">    <span class="keywordtype">bool</span> isRunning = <span class="keyword">true</span>, isFreezed = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Main Loop</span></div>
<div class="line">    <span class="keywordflow">while</span> (isRunning) {</div>
<div class="line">        <span class="comment">// Update Monitor</span></div>
<div class="line">        <span class="keywordflow">if</span> (!isFreezed) {</div>
<div class="line">            m.update();</div>
<div class="line">            pe.update();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Handle Terminal Event</span></div>
<div class="line">        <span class="keywordtype">int</span> c = <a class="code" href="classcea_1_1Console.html#a1e93434f12197a14f59107045f7deced" title="Get async terminal key hit.">Console::keyHit</a>();</div>
<div class="line">        <span class="keywordflow">switch</span> (c) {</div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            <span class="comment">// = No key hit (keyHit is async method -&gt; return 0 if no key)</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;Q&#39;</span>:</div>
<div class="line">            <span class="comment">// Key for exit the application</span></div>
<div class="line">            isRunning = <span class="keyword">false</span>;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;P&#39;</span>:</div>
<div class="line">            <span class="comment">// Key to pause the monitor</span></div>
<div class="line">            isFreezed = (!isFreezed);</div>
<div class="line">            <span class="comment">// Force render will make needRender return true (see bellow)</span></div>
<div class="line">            view.forceRender();</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="comment">// If other key -&gt; let the terminal controller handle the event</span></div>
<div class="line">            termCtrl.handleTerminalEvent(c);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Render</span></div>
<div class="line">        <span class="keywordflow">if</span> (view.needRender()) {</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Draw a tips text</span></div>
<div class="line">            <a class="code" href="classcea_1_1Console.html#a631acdc7fe7195dac6391fa0072afb00" title="Draw a text to the current position with the current console style.">Console::drawText</a>(<span class="stringliteral">&quot;Columns count=&quot;</span> +</div>
<div class="line">                                <a class="code" href="classcea_1_1Tools.html#ac52be791d384961fd898770ec24bd50d" title="Convert almost any variable into a string.">Tools::CStr</a>(view.getColumnViewCount()) +</div>
<div class="line">                                <span class="stringliteral">&quot;, Row count=&quot;</span> +</div>
<div class="line">                                <a class="code" href="classcea_1_1Tools.html#ac52be791d384961fd898770ec24bd50d" title="Convert almost any variable into a string.">Tools::CStr</a>(view.getRowViewCount()) +</div>
<div class="line">                                (isFreezed ? <span class="stringliteral">&quot; - PAUSED&quot;</span> : <span class="stringliteral">&quot;         &quot;</span>),</div>
<div class="line">                                0, 2,</div>
<div class="line">                                <a class="code" href="structcea_1_1Console_1_1DrawStyle.html" title="Console style structure used by drawText.">Console::DrawStyle</a>(<a class="code" href="classcea_1_1Color.html#ae9b2bde19669769a802099bc7e0f06be" title="#FFFF00 rgb(255, 255, 0);">Color::Yellow</a>));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Refresh size of view</span></div>
<div class="line">            view.refreshAutoSize();</div>
<div class="line">            <span class="comment">// Finally render the view</span></div>
<div class="line">            view.render();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Do a sleep of 50 ms to avoid comsuption of all CPU</span></div>
<div class="line">        <span class="comment">// with letting the interpretation of key event</span></div>
<div class="line">        <a class="code" href="classcea_1_1Tools.html#a83760270530fbfde07cb6db7aa81f22a" title="Sleep the current process for a period expressed in milliseconds.">Tools::sleep_ms</a>(50);</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
